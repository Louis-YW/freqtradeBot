{
  "id": "topic_5415431",
  "title": "edjanx",
  "author": "edjanx",
  "created_time": "September 30, 2022, 12:19:22 AMLast edit: September 30, 2022, 01:19:22 AM by edjanx",
  "content": "Greetings friends of Satoshi!I have been running Bitcoin Full Node 23.0.0 over Tor to do my part to contribute to the cause. I am using Windows 11 on a freshly formatted PC with the Bitcoin Core data on an external USB 3.0 SSD. Everything has been working fine with little stress on a 2 year old PC.Recently I decided to configure a newly formatted Nano S hardware wallet with Electrum Wallet 4.3.2, connecting it to my Node via Electrum Personal Server 0.2.4.  I connected the Nano to Electrum wallet successfully, displaying a fresh set of wallet addresses. I then copied the Master Public Key to use in the Electrum Personal Server (EPS) config.ini file, as well as other settings I've researched for that and bitcoin.conf (Bitcoin Core).I ran EPS, connected to Bitcoin Core, and it imported the Nano S wallet from Electrum, which became the first Bitcoin Core wallet installed on the Core. Next I validated the wallet addresses visible in Electrum Wallet matched those on the Bitcoin Core. However, upon attempting to reconnect the Electrum Wallet to the EPS, I have no longer have a connection between them. I should note that it was recommended to launch Electrum so that it only connects to localhost on EPS server port 50002. \"C:\\Program Files (x86)\\Electrum\\electrum-4.3.2.exe\" --oneserver --server localhost:50002:sWithout that modification, Electrum sees external servers that it can connect to, but not EPS on localhost:50002. With the modification, no external servers are available, but it doesn't connect, with localhost:50002 specified but greyed out. Here are the Electrum logfiles, which include the connection errors. I will also include the EPS and Bitcoin Node configurations below that:20220929T223930.804107Z |     INFO | simple_config.SimpleConfig | electrum directory C:\\Users\\xxxxx\\AppData\\Roaming\\Electrum20220929T223930.804107Z |     INFO | logging | Electrum version: 4.3.2 - https://electrum.org - https://github.com/spesmilo/electrum20220929T223930.877107Z |     INFO | logging | Python version: 3.9.11 (tags/v3.9.11:2de452f, Mar 16 2022, 14:21:37) [MSC v.1929 32 bit (Intel)]. On platform: Windows-10-10.0.22000-SP020220929T223930.877107Z |     INFO | logging | Logging to file: C:\\Users\\xxxxx\\AppData\\Roaming\\Electrum\\logs\\electrum_log_20220929T223930Z_9564.log20220929T223930.877107Z |     INFO | logging | Log filters: verbosity '', verbosity_shortcuts ''<SNIP>20220929T223930.892730Z |     INFO | plugin.Plugins | registering hardware ledger: ('hardware', 'ledger', 'Ledger wallet')<SNIP>20220929T223930.908756Z |    DEBUG | util.profiler | Plugins.__init__ 0.0316 sec20220929T223930.908756Z |     INFO | network | blockchains 20220929T223930.908756Z |     INFO | util | registering callback <bound method FxThread.on_event_proxy_set of <electrum.exchange_rate.FxThread object at 0x048FEEB0>>20220929T223930.908756Z |     INFO | exchange_rate.FxThread | using exchange CoinGecko20220929T223930.908756Z |     INFO | network | starting network20220929T223930.908756Z |    DEBUG | util.profiler | Daemon.__init__ 0.0000 sec20220929T223930.908756Z |     INFO | daemon.Daemon | launching GUI: qt20220929T223930.908756Z |     INFO | network | setting proxy None20220929T223930.908756Z |     INFO | network | connecting to localhost:50002:s as new interface20220929T223930.908756Z |     INFO | interface.[localhost:50002] | looks like localhost: not using proxy for this server20220929T223930.908756Z |     INFO | daemon.Daemon | starting taskgroup.20220929T223930.908756Z |     INFO | network | starting taskgroup (0x48fef58).20220929T223930.955627Z |     INFO | daemon.CommandsServer | now running and listening. socktype=tcp, addr=('127.0.0.1', 59520)20220929T223931.018508Z |     INFO | gui.qt.history_list | could not import electrum.plot. This feature needs matplotlib to be installed.20220929T223931.034140Z |     INFO | gui.qt.ElectrumGui | Qt GUI starting up... Qt=5.15.2, PyQt=5.15.620220929T223931.238055Z |    DEBUG | util.profiler | ElectrumGui.__init__ 0.2039 sec20220929T223931.238055Z |     INFO | storage.WalletStorage | wallet path c:\\users\\xxxx\\appdata\\roaming\\electrum\\wallets\\nanos20220929T223932.037424Z |     INFO | storage.WalletStorage | wallet path c:\\users\\xxxx\\appdata\\roaming\\electrum\\wallets\\nanos20220929T223934.334555Z |     INFO | plugin.Plugins | loaded bitbox0220220929T223934.352507Z |     INFO | plugin.Plugins | loaded coldcard20220929T223934.367467Z |     INFO | plugin.Plugins | loaded digitalbitbox20220929T223934.380432Z |  WARNING | jade | No module named 'electrum.plugins.jade.jadepy.jade_ble'20220929T223934.380432Z |  WARNING | jade | BLE scanning/connectivity will not be available<SNIP>20220929T223934.488145Z |     INFO | plugin.Plugins | loaded ledger<SNIP>20220929T223934.633285Z |     INFO | plugin.DeviceMgr | scanning devices...20220929T223935.046650Z |     INFO | interface.[localhost:50002] | disconnecting due to: ErrorGettingSSLCertFromServer(ConnectError(ConnectionRefusedError(22, 'The remote computer refused the network connection', None, 1225, None)))20220929T223935.046650Z |     INFO | network | couldn't launch iface localhost:50002:s -- CancelledError()20220929T223935.156640Z |     INFO | network | connecting to localhost:50002:s as new interface20220929T223935.156640Z |     INFO | interface.[localhost:50002] | looks like localhost: not using proxy for this server20220929T223936.811255Z |    DEBUG | util.profiler | DeviceMgr.scan_devices 2.1780 sec20220929T223936.874686Z |     INFO | plugin.DeviceMgr | Registering <electrum.plugins.ledger.ledger.Ledger_Client object at 0x0DAAC0A0>20220929T223938.745822Z |     INFO | plugin.DeviceMgr | scanning devices...20220929T223938.905209Z |    DEBUG | util.profiler | DeviceMgr.scan_devices 0.1594 sec20220929T223939.218804Z |     INFO | interface.[localhost:50002] | disconnecting due to: ErrorGettingSSLCertFromServer(ConnectError(ConnectionRefusedError(22, 'The remote computer refused the network connection', None, 1225, None)))20220929T223939.218804Z |     INFO | network | couldn't launch iface localhost:50002:s -- CancelledError() Electrum Personal Server config.ini file[master-public-keys]nanos = zpub6qUwA3bFULrnxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxtbuh63R1SFyffzZky#from electrum wallet connected to nano s[bitcoin-rpc]host = 127.0.0.1port = 8332#standard Bitcoin Core port and localhost ipdatadir = E:\\Bitcoin#external USB 3.0 SSDrpc_user = examplerpc_password = hashwallet_filename =# empty means default file poll_interval_listening = 30poll_interval_connected = 5gap_limit = 25[electrum-server]host = 127.0.0.1port = 50002#standard Electrum Personal Server (EPS) port and localhost ipip_whitelist = *#SSL certificatecertfile = certs/cert.crtkeyfile = certs/cert.keydisable_mempool_fee_histogram = falsemempool_update_interval = 60broadcast_method = tor-or-own-nodetor_host = 127.0.0.1tor_port = 9150#standard Tor port and localhost ipappend_log = falselog_format = %(levelname)s:%(asctime)s: %(message)sBITCOIN.CONFIG file:server=1daemon=1listen=1txindex=1onlynet=onionproxy=127.0.0.1:9150bind=127.0.0.1walletbroadcast=0rpcuser=hierophantrpcpassword=93418rpcallowip=127.0.0.1rpcbind=127.0.0.1datadir=E:\\\\BitcoinSorry for the long post, but I also checked if 127.0.0.1 was open to all internal apps, and even specified both Electrum Server and EPS apps as safe in Windows 11. If anyone can help get me through this, it will be amazing after two days pouring through Google, where Windows configuration content on a pure Windows implementation seems especially rare. Thanks!Janx",
  "score": 0,
  "upvotes": 0,
  "downvotes": 0,
  "url": "https://bitcointalk.org/index.php?topic=5415431",
  "comments": [
    {
      "author": "vv181",
      "created_time": "September 30, 2022, 01:42:17 AM",
      "body": "Can you try to verify that EPS is still running using:Code:netstat -aExecute it on CMD, and see whether the :50002 port is open or not.If it's running, you should try to delete the cached cert file on Electrum.QuoteOn Windows:    Show hidden files    Go to \\Users\\YourUserName\\AppData\\Roaming\\Electrum\\certs (or %APPDATA%\\Electrum]certs)There might be a localhost file, delete it, and try run the Electrum again.",
      "score": 0,
      "upvotes": 0,
      "downvotes": 0
    },
    {
      "author": "NeuroticFish",
      "created_time": "September 30, 2022, 05:26:30 AM",
      "body": "Quote from: edjanx on September 30, 2022, 12:19:22 AM20220929T223939.218804Z |     INFO | interface.[localhost:50002] | disconnecting due to: ErrorGettingSSLCertFromServer(ConnectError(ConnectionRefusedError(22, 'The remote computer refused the network connection', None, 1225, None)))20220929T223939.218804Z |     INFO | network | couldn't launch iface localhost:50002:s -- CancelledError()Since your server is unable to offer SSL connection, maybe you try to connect without SSL, especially as you're working locally?To do so, instead of localhost:50002:s you should try localhost:50002:t (although normally it should have been 50001:t, but I think that you haven't configure that port).Another direction would probably be to configure SSL for EPS.",
      "score": 0,
      "upvotes": 0,
      "downvotes": 0
    },
    {
      "author": "edjanx",
      "created_time": "October 01, 2022, 03:17:08 PMLast edit: October 01, 2022, 03:37:56 PM by edjanx",
      "body": "Quote from: vv181 on September 30, 2022, 01:42:17 AMCan you try to verify that EPS is still running using:Code:netstat -aExecute it on CMD, and see whether the :50002 port is open or not.If it's running, you should try to delete the cached cert file on Electrum.QuoteOn Windows:    Show hidden files    Go to \\Users\\YourUserName\\AppData\\Roaming\\Electrum\\certs (or %APPDATA%\\Electrum]certs)There might be a localhost file, delete it, and try run the Electrum again.Thank you for your assistance VV181. Great suggestion on netstat -a, but to my surprise there is no connection running over port 50002, 127.0.0.1 or otherwise. I also checked the Electrum cert file folder and it is empty. I tried copying the certs from EPS over but no difference. I had wondered if EPS was actually running as there doesn't seem to have a UI so I assumed it was running headless. This is the result on the command line that launches when when I drop the the config.ini on the EPS executable:INFO:2022-10-01 11:08:37,909: Starting Electrum Personal Server 0.2.4INFO:2022-10-01 11:08:37,909: Logging to C:\\Users\\edjan\\AppData\\Local\\Temp/electrumpersonalserver.logINFO:2022-10-01 11:08:37,940: Displaying first 3 addresses of each master public key:INFO:2022-10-01 11:08:37,940:freya =>        bc1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxcr8u429        bc1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxgpprzs9        bc1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxjhmh8x5INFO:2022-10-01 11:08:37,956: Obtaining bitcoin addresses to monitor . . .Press any key to continue . . .Regardless if I press a key to continue, netstat didn't detect any activity on port 50002. Should something else be happening when I launch EPS, or is there something else I may be missing? Again, many thanks!Janx",
      "score": 0,
      "upvotes": 0,
      "downvotes": 0
    },
    {
      "author": "edjanx",
      "created_time": "October 01, 2022, 03:49:20 PM",
      "body": "Quote from: NeuroticFish on September 30, 2022, 05:26:30 AMQuote from: edjanx on September 30, 2022, 12:19:22 AM20220929T223939.218804Z |     INFO | interface.[localhost:50002] | disconnecting due to: ErrorGettingSSLCertFromServer(ConnectError(ConnectionRefusedError(22, 'The remote computer refused the network connection', None, 1225, None)))20220929T223939.218804Z |     INFO | network | couldn't launch iface localhost:50002:s -- CancelledError()Since your server is unable to offer SSL connection, maybe you try to connect without SSL, especially as you're working locally?To do so, instead of localhost:50002:s you should try localhost:50002:t (although normally it should have been 50001:t, but I think that you haven't configure that port).Another direction would probably be to configure SSL for EPS.I appreciate your suggestion NeuroticFish. I actually did read about trying the non-secure 50001 port but ended up with the same result, which I'm now realizing is strange since certs shouldn't be utilized over a non-secure port. I also tired your suggestion to change localhost:50002:t to 50002:s without success, although I admit that I don't know what the S vs. T specification does.Lastly, I'm not sure how to configure SSL for EPS. If you know of a good guide or have a suggestion, I'd gladly try that. Regards,Ed",
      "score": 0,
      "upvotes": 0,
      "downvotes": 0
    },
    {
      "author": "NeuroticFish",
      "created_time": "October 01, 2022, 04:23:50 PM",
      "body": "Quote from: edjanx on October 01, 2022, 03:49:20 PMI appreciate your suggestion NeuroticFish. I actually did read about trying the non-secure 50001 port but ended up with the same result, which I'm now realizing is strange since certs shouldn't be utilized over a non-secure port. I also tired your suggestion to change localhost:50002:t to 50002:s without success, although I admit that I don't know what the S vs. T specification does.You can go to this page and search for 50002.Shortly, T means TCP, S means TLS. The thing is that TCP is by default on 50001 and TLS is by default on 50002.However, from what I see in your other answer I think that EPS may not actually be running or may not be expecting connections, and that's what you have to fix first in order to be abler to connect.Quote from: edjanx on October 01, 2022, 03:49:20 PMLastly, I'm not sure how to configure SSL for EPS. If you know of a good guide or have a suggestion, I'd gladly try that. Sorry, I don't know how to do that. I tried working with EPS and found out to be too restrictive for my liking and gave it up.I remember that I've also tried to use it with Sparrow wallet and that one gave better hints/error messages (than Electrum).What I have installed was Electrs, even made a full tutorial for it: https://bitcointalk.org/index.php?topic=5367296But on EPS, sorry, my knowledge is rather limited. Maybe others give you better hints.",
      "score": 0,
      "upvotes": 0,
      "downvotes": 0
    },
    {
      "author": "edjanx",
      "created_time": "October 03, 2022, 10:57:36 PMLast edit: October 04, 2022, 03:39:59 PM by edjanx",
      "body": "Thanks again to NeuroticFish and vv81 for trying to solve why this error was appearing in my Eelctrum logs when trying to connect to EPS. 20220929T223939.218804Z |     INFO | interface.[localhost:50002] | disconnecting due to: ErrorGettingSSLCertFromServer(ConnectError(ConnectionRefusedError(22, 'The remote computer refused the network connection', None, 1225, None)))20220929T223939.218804Z |     INFO | network | couldn't launch iface localhost:50002:s -- CancelledError()I can finally connect a Ledger Nano to an Electrum Wallet to a Bitcoin Node via Electrum Personal Server on Windows 11! I wanted to follow up in case this helps other Windows users, especially as current documentation is scarce vs. other OS platforms.It turns out that Electrum Personal Server was not fully starting, which translated to Electrum logs throwing a cert error from a server that wasn't started to provide it.  I found special instructions especially for Bitcoin Core v23 which says to run the following command in the Node under 'Help --> Command Line Options' bitcoin-cli createwallet electrumpersonalserver true true \"\" false false true\" BTW, don't make the mistake of trying to run that command from 'Window --> Console' as it doesn't work there.  I then verified that the electrumpersonalserver wallet was created in Bitcoin Node, which it was. I then closed the other wallet on the Node to avoid conflict.  After all of this..... Still no connection from Electrum to EPS.  Finally I messed with both the EPS config.ini file and the Node's bitcon.conf.  The first time I started EPS, I was finally able to connect Electrum to the Bitcoin Node, and  I also finally saw the electrum-watchonly-adresses under Bitcoin Node's 'Windows-->Receiving Addressers'.Here is the successful connection messages from the EPS command line window in case it helps others know what they are looking for:INFO:2022-10-03 16:27:52,299: Obtaining bitcoin addresses to monitor . . .INFO:2022-10-03 16:27:52,299: Importing 1 wallets and 0 watch-only addresses into the Bitcoin nodeDEBUG:2022-10-03 16:27:57,301: Importing 0 watch-only address[es] and 1 wallet(s) into label \"electrum-watchonly-addresses\"INFO:2022-10-03 16:27:57,333: Importing wallet 1/1DEBUG:2022-10-03 16:27:58,369: Importing doneINFO:2022-10-03 16:27:58,369: Done.If recovering a wallet which already has existing transactions, thenrun the rescan script. If you're confident that the wallets are newand empty then there's no need to rescan, just restart this scriptINFO:2022-10-03 16:57:11,787: Starting Electrum Personal Server 0.2.4INFO:2022-10-03 16:57:11,787: Logging to C:\\Users\\edjan\\AppData\\Local\\Temp/electrumpersonalserver.logDEBUG:2022-10-03 16:57:11,787: Process ID (PID) = 7612DEBUG:2022-10-03 16:57:11,787: obtaining auth from rpc_user/passDEBUG:2022-10-03 16:57:11,803: Checking whether rescan is in progressINFO:2022-10-03 16:57:11,818: Displaying first 3 addresses of each master public key:INFO:2022-10-03 16:57:11,818: xxxxx =>   bc1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx429   bc1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxrzs9   bc1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx8x5INFO:2022-10-03 16:57:11,850: Obtaining bitcoin addresses to monitor . . .NOTE: This is where it would stop before I was able to connect successfully.  It also stated 'press any key to continue', which would close the window.But on this attempt, it continued!INFO:2022-10-03 16:57:13,857: Obtained list of addresses to monitor in 2.0384793281555176secINFO:2022-10-03 16:57:13,857: Building history with 2000 addresses . . .DEBUG:2022-10-03 16:57:13,872: listtransactions skip=0 len(ret)=0DEBUG:2022-10-03 16:57:13,888: unconfirmed_txes = defaultdict(<class 'list'>, {})DEBUG:2022-10-03 16:57:13,888: reorganizable_txes = []DEBUG:2022-10-03 16:57:13,888: last_known_wallet_txid = NoneINFO:2022-10-03 16:57:13,888: Found 0 txes. History built in 0.031243562698364258secDEBUG:2022-10-03 16:57:13,888: Starting electrum serverDEBUG:2022-10-03 16:57:13,894: using cert: certs/cert.crt, key: certs/cert.keyINFO:2022-10-03 16:57:13,894: Synchronizing mempool . . .INFO:2022-10-03 16:57:15,456: Found 1632 mempool entries. Synchronized mempool in 1.5626723766326904secINFO:2022-10-03 16:57:15,456: Listening for Electrum Wallet on ('127.0.0.1', 50002)Bitcoin.conf server=1daemon=1listen=1txindex=1onlynet=onionproxy=127.0.0.1:9150bind=127.0.0.1wallet=electrumpersonalserverwalletbroadcast=0rpcuser=usernamerpcpassword=passwordrpcallowip=127.0.0.1rpcbind=127.0.0.1datadir=F:\\\\BitcoinEPS config.ini Configuration# Electrum Personal Server configuration file# Lines starting with # are called comments which are ignored.# For a line to have effect it must not start with ## The most important options are towards the top of the file[master-public-keys]# Add electrum wallet master public keys to this section# In electrum then go Wallet -> Information to get the mpk#any_name_works = xpub661MyMwAqRbcFseXCwRdRVkhVuzEiskg4QUp5XpUdNf2uGXvQmnD4zcofZ1MN6Fo8PjqQ5cemJQ 39f7RTwDVVputHMFjPUn8VRp2pJQMgEFanyname= xpub66xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx xxxxxxxxxxxxxxxxxzZky# Multiple master public keys may be added by simply adding another line#my_second_wallet = xpubanotherkey[bitcoin-rpc]host = 127.0.0.1port = 8332#add the bitcoin datadir to search for the .cookie file created by the# node, which avoids the need to configure rpc_user/pass#leave this option empty to have it look in the default locationdatadir = F:\\Bitcoin#if you dont want to use the .cookie method with datadir, uncomment to config u/p hererpc_user = usernamerpc_password = password#to be used with the multi-wallet feature# see https://github.com/bitcoin/bitcoin/blob/master/doc/release-notes/release-notes-0.15.0.md#multi-wallet-support# empty means default file, for when using a single wallet filewallet_filename =# how often in seconds to poll for new transactions when electrum not connectedpoll_interval_listening = 30# how often in seconds to poll for new transactions when electrum is connectedpoll_interval_connected = 5# Parameters for dealing with deterministic wallets# how many addresses to import first time, should be big because if you import too little you may have to rescan againinitial_import_count = 1000# number of unused addresses kept at the head of the walletgap_limit = 25[electrum-server]# 0.0.0.0 to accept connections from any IP#127.0.0.1 to accept from only localhosthost = 127.0.0.1port = 50002# space-separated whitelist of IP addresses# accepts CIDR notation eg 192.168.0.0/16 or 2a01:4f8:1f1::/120# star (*) means all are accepted# generally requires host binding (above) to be 0.0.0.0ip_whitelist = *#SSL certificate#uses the default one, which is fine because by default nobody should be# allowed to connect to your server or scan your packets#to generate another certificate see https://github.com/spesmilo/electrum-server/blob/ce1b11d7f5f7a70a3b6cc7ec1d3e552436e54ffe/HOWTO.md#step-8-create-a-self-signed-ssl-certcertfile = certs/cert.crtkeyfile = certs/cert.key# Option for disabling the fee histogram calculation# It improves server responsiveness but stops mempool-based Electrum features# This is useful on low powered devices at times when the node mempool is largedisable_mempool_fee_histogram = false# How often in seconds to update the mempool# this mempool is used to calculate the mempool fee histogrammempool_update_interval = 60# Parameter for broadcasting unconfirmed transactions# Options are:# * tor-or-own-node  (use tor if tor is running locally, otherwise own-node)# * own-node         (broadcast using the connected full node)# * tor              (broadcast to random nodes over tor)# * system <cmd> %s  (save transaction to file, and invoke system command#                     with file path as parameter %s)broadcast_method = tor-or-own-node# For tor broadcasting (broadcast_method = tor) configure# the tor proxy host and port belowtor_host = 127.0.0.1tor_port = 9150# = Notes on tor broadcasting =# If using tor broadcasting, make sure you set `walletbroadcast=0` in#  your bitcoin.conf file# If your full node is connected to the internet only via tor then you dont#  need separate tor broadcasting[watch-only-addresses]#Add individual addresses to this section, for example paper wallets#Dont use this section for adding entire wallets, instead use the# above section `master-public-keys`#addr = 1DuqpoeTB9zLvVCXQG53VbMxvMkijk494n# A space separated list is also accepted#my_test_addresses = 3Hh7QujVLqz11tiQsnUE5CSL16WEHBmiyR 1PXRLo1FQoZyF1Jhnz4qbG5x8Bo3pFpybz bc1qar0srrr7xfkvy5l643lydnw9re59gtzzwf5mdq# multiple addresses may also be added in separate lines (like master public keys above)#addr2 = 3anotheraddress[logging]# Section for configuring the logging output# The log level. Logging messages less severe than this will not be displayed#options are 'DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL'#Information printed to the log file is always at level DEBUGlog_level_stdout = INFO# Location of log file, leave empty to use the default location in temp dirlog_file_location =# Whether to append to log file or delete and overwrite on startupappend_log = false# Format to use for logging messages#see docs https://docs.python.org/3/library/logging.html#formatter-objectslog_format = %(levelname)s:%(asctime)s: %(message)s",
      "score": 0,
      "upvotes": 0,
      "downvotes": 0
    }
  ]
}